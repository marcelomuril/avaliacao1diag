<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AvaliaÃ§Ã£o DiagnÃ³stica 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <!-- CabeÃ§alho -->
  <header class="bg-blue-800 text-white py-6 shadow-lg text-center">
    <h1 class="text-3xl font-bold">CCM SEBASTIÃƒO PARANÃ</h1>
    <h2 class="text-xl mt-2">1Âª AvaliaÃ§Ã£o DiagnÃ³stica 2025</h2>
  </header>

  <!-- SeleÃ§Ã£o -->
  <main class="max-w-5xl mx-auto p-6">
    <div class="grid md:grid-cols-3 gap-4 mb-6">
      <select id="anoSelect" class="p-3 rounded-lg border shadow">
        <option value="">Selecione o Ano Escolar</option>
        <option value="9">9Âº Ano - Fundamental</option>
        <option value="3">3Âª SÃ©rie - Ensino MÃ©dio</option>
      </select>

      <select id="alunoSelect" class="p-3 rounded-lg border shadow">
        <option value="">Selecione o Aluno</option>
      </select>

      <button onclick="carregarGrafico()" 
        class="bg-blue-700 hover:bg-blue-900 text-white px-4 py-2 rounded-lg shadow">
        Mostrar Desempenho
      </button>
    </div>

    <!-- GrÃ¡fico -->
    <div class="bg-white p-4 rounded-2xl shadow-lg mb-6">
      <canvas id="grafico" class="w-full h-96"></canvas>
    </div>

    <!-- Descritores -->
    <div id="descritores" class="bg-white p-6 rounded-2xl shadow-lg"></div>
  </main>

  <script>
    let dadosCSV = { port3: [], mat3: [], port9: [], mat9: [] };
    let chart;

    // descritores genÃ©ricos para pais
    const descritoresPort = {
      P01: "Identificar informaÃ§Ãµes diretas em um texto. AplicaÃ§Ã£o: leitura de avisos, instruÃ§Ãµes simples. PrejuÃ­zo: dificuldade em compreender mensagens bÃ¡sicas.",
      P02: "Reconhecer a ideia principal. AplicaÃ§Ã£o: estudos e provas. PrejuÃ­zo: perde a noÃ§Ã£o do que o texto quer dizer.",
      P03: "Interpretar o sentido de palavras em contexto. AplicaÃ§Ã£o: leitura de notÃ­cias e histÃ³rias. PrejuÃ­zo: interpretaÃ§Ãµes equivocadas.",
      P04: "Inferir informaÃ§Ãµes implÃ­citas. AplicaÃ§Ã£o: compreender textos alÃ©m do Ã³bvio. PrejuÃ­zo: leitura superficial.",
      P05: "Reconhecer diferentes gÃªneros textuais. AplicaÃ§Ã£o: adaptar a leitura ao tipo de texto. PrejuÃ­zo: confusÃ£o entre textos informativos e opinativos.",
      P06: "Compreender o uso de pronomes e coesÃ£o. AplicaÃ§Ã£o: seguir o raciocÃ­nio textual. PrejuÃ­zo: leitura fragmentada.",
      P07: "Identificar a finalidade de um texto. AplicaÃ§Ã£o: diferenciar entre informar, convencer, entreter. PrejuÃ­zo: mÃ¡ interpretaÃ§Ã£o da intenÃ§Ã£o.",
      P08: "Reconhecer figuras de linguagem. AplicaÃ§Ã£o: literatura e expressÃµes comuns. PrejuÃ­zo: dificuldade em interpretar sentidos figurados.",
      P09: "Relacionar texto e imagem. AplicaÃ§Ã£o: infogrÃ¡ficos, propagandas. PrejuÃ­zo: leitura incompleta de informaÃ§Ãµes.",
      P10: "Compreender relaÃ§Ãµes lÃ³gicas no texto. AplicaÃ§Ã£o: conectar ideias. PrejuÃ­zo: dificuldade em seguir argumentos.",
      P11: "Distinguir fato de opiniÃ£o. AplicaÃ§Ã£o: leitura crÃ­tica. PrejuÃ­zo: pode acreditar em fake news.",
      P12: "Identificar recursos argumentativos. AplicaÃ§Ã£o: debates e redaÃ§Ãµes. PrejuÃ­zo: baixa capacidade de argumentar.",
      P13: "Compreender organizaÃ§Ã£o de parÃ¡grafos. AplicaÃ§Ã£o: produÃ§Ã£o de textos. PrejuÃ­zo: redaÃ§Ãµes confusas.",
      P14: "Reconhecer variaÃ§Ãµes linguÃ­sticas. AplicaÃ§Ã£o: respeitar contextos culturais. PrejuÃ­zo: preconceito linguÃ­stico.",
      P15: "Relacionar textos diferentes. AplicaÃ§Ã£o: comparar fontes. PrejuÃ­zo: visÃ£o limitada de um tema."
    };

    const descritoresMat = {
      M01: "Efetuar operaÃ§Ãµes de adiÃ§Ã£o e subtraÃ§Ã£o. AplicaÃ§Ã£o: compras e cÃ¡lculos simples. PrejuÃ­zo: dependÃªncia da calculadora.",
      M02: "Efetuar multiplicaÃ§Ã£o e divisÃ£o. AplicaÃ§Ã£o: partilhas, problemas prÃ¡ticos. PrejuÃ­zo: erros em situaÃ§Ãµes cotidianas.",
      M03: "Resolver problemas com fraÃ§Ãµes. AplicaÃ§Ã£o: receitas, medidas. PrejuÃ­zo: dificuldade em dividir ou entender proporÃ§Ãµes.",
      M04: "Utilizar nÃºmeros decimais. AplicaÃ§Ã£o: dinheiro, notas. PrejuÃ­zo: erros em cÃ¡lculos financeiros.",
      M05: "Interpretar porcentagens. AplicaÃ§Ã£o: descontos, juros. PrejuÃ­zo: nÃ£o compreender promoÃ§Ãµes ou taxas.",
      M06: "Calcular mÃ©dia aritmÃ©tica. AplicaÃ§Ã£o: notas escolares, estatÃ­sticas. PrejuÃ­zo: nÃ£o saber avaliar desempenhos.",
      M07: "Resolver equaÃ§Ãµes simples. AplicaÃ§Ã£o: problemas de lÃ³gica. PrejuÃ­zo: dificuldade em Ã¡lgebra bÃ¡sica.",
      M08: "Identificar propriedades geomÃ©tricas. AplicaÃ§Ã£o: desenho, construÃ§Ãµes. PrejuÃ­zo: erros em medidas e formas.",
      M09: "Calcular Ã¡rea de figuras planas. AplicaÃ§Ã£o: pintura, piso. PrejuÃ­zo: nÃ£o saber planejar espaÃ§o.",
      M10: "Calcular volume de sÃ³lidos. AplicaÃ§Ã£o: caixas, recipientes. PrejuÃ­zo: problemas em armazenamento.",
      M11: "Interpretar grÃ¡ficos e tabelas. AplicaÃ§Ã£o: notÃ­cias, dados. PrejuÃ­zo: nÃ£o compreender informaÃ§Ãµes visuais.",
      M12: "Resolver problemas de proporÃ§Ã£o. AplicaÃ§Ã£o: mapas, escalas. PrejuÃ­zo: cÃ¡lculos incorretos.",
      M13: "Trabalhar com grandezas e medidas. AplicaÃ§Ã£o: receitas, construÃ§Ãµes. PrejuÃ­zo: uso inadequado de medidas.",
      M14: "Identificar simetria. AplicaÃ§Ã£o: artes, design. PrejuÃ­zo: dificuldade em visualizaÃ§Ã£o espacial.",
      M15: "Resolver problemas com Ã¢ngulos. AplicaÃ§Ã£o: construÃ§Ãµes, desenhos tÃ©cnicos. PrejuÃ­zo: erros em cÃ¡lculos geomÃ©tricos.",
      M16: "Compreender probabilidade. AplicaÃ§Ã£o: jogos, previsÃµes. PrejuÃ­zo: interpretaÃ§Ãµes erradas de riscos.",
      M17: "Resolver sistemas de equaÃ§Ãµes. AplicaÃ§Ã£o: cÃ¡lculos avanÃ§ados. PrejuÃ­zo: dificuldades em matemÃ¡tica superior.",
      M18: "Trabalhar com funÃ§Ãµes. AplicaÃ§Ã£o: ciÃªncias, economia. PrejuÃ­zo: limitaÃ§Ãµes em anÃ¡lises grÃ¡ficas."
    };

    // carregar CSVs
    const arquivos = {
      "9": { port: "port9.csv", mat: "mat9.csv" },
      "3": { port: "port3.csv", mat: "mat3.csv" }
    };

    document.getElementById("anoSelect").addEventListener("change", e => {
      const ano = e.target.value;
      const alunoSelect = document.getElementById("alunoSelect");
      alunoSelect.innerHTML = "<option value=''>Selecione o Aluno</option>";

      if (!ano) return;

      ["port", "mat"].forEach(disc => {
        Papa.parse(arquivos[ano][disc], {
          download: true,
          header: true,
          complete: res => {
            dadosCSV[disc + ano] = res.data;
            if (disc === "port") {
              res.data.forEach(linha => {
                if (linha.Estudante && ![...alunoSelect.options].some(o => o.value === linha.Estudante)) {
                  alunoSelect.innerHTML += `<option value="${linha.Estudante}">${linha.Estudante}</option>`;
                }
              });
            }
          }
        });
      });
    });

    function carregarGrafico() {
      const ano = document.getElementById("anoSelect").value;
      const aluno = document.getElementById("alunoSelect").value;
      if (!ano || !aluno) return;

      const port = dadosCSV["port" + ano].find(l => l.Estudante === aluno);
      const mat = dadosCSV["mat" + ano].find(l => l.Estudante === aluno);

      const labels = [
        ...Object.keys(descritoresPort),
        ...Object.keys(descritoresMat)
      ];

      const portData = Object.keys(descritoresPort).map(h => parseInt(port?.[h.replace("P", "H")] || 0));
      const matData = Object.keys(descritoresMat).map(h => parseInt(mat?.[h.replace("M", "H")] || 0));

      const ctx = document.getElementById("grafico").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [
            { label: "PortuguÃªs", data: [...portData, ...Array(18).fill(null)], backgroundColor: "rgba(54,162,235,0.7)" },
            { label: "MatemÃ¡tica", data: [...Array(15).fill(null), ...matData], backgroundColor: "rgba(255,99,132,0.7)" }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            tooltip: {
              callbacks: {
                label: ctx => {
                  const key = ctx.label;
                  return (descritoresPort[key] || descritoresMat[key]) + " â†’ Acertos: " + ctx.formattedValue;
                }
              }
            }
          },
          scales: { y: { beginAtZero: true } }
        }
      });

      // descritores abaixo
      let html = `<h3 class="text-xl font-bold mb-3">ğŸ“˜ PortuguÃªs</h3><ul class="list-disc pl-5 mb-6">`;
      for (let [k,v] of Object.entries(descritoresPort)) html += `<li><b>${k}</b> â€“ ${v}</li>`;
      html += `</ul><h3 class="text-xl font-bold mb-3">ğŸ”¢ MatemÃ¡tica</h3><ul class="list-disc pl-5">`;
      for (let [k,v] of Object.entries(descritoresMat)) html += `<li><b>${k}</b> â€“ ${v}</li>`;
      html += `</ul>`;
      document.getElementById("descritores").innerHTML = html;
    }
  </script>
</body>
</html>
