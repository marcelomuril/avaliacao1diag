<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avaliação Diagnóstica 2025</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Cabeçalho -->
  <header class="bg-blue-900 text-white py-6 shadow-lg">
    <h1 class="text-center text-3xl font-bold">CCM Sebastião Paraná</h1>
    <h2 class="text-center text-xl mt-2">1ª Avaliação Diagnóstica 2025</h2>
  </header>

  <main class="p-6 max-w-6xl mx-auto">
    <!-- Seleção -->
    <div class="flex flex-col md:flex-row gap-4 mb-6">
      <select id="turmaSelect" class="p-3 border rounded-lg shadow focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">Selecione a turma</option>
        <option value="9ano">9º Ano</option>
        <option value="3serie">3ª Série EM</option>
      </select>

      <select id="alunoSelect" class="p-3 border rounded-lg shadow focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">Selecione o aluno</option>
      </select>
    </div>

    <!-- Caixa com nome e nível -->
    <div id="infoAluno" class="hidden p-4 bg-green-100 border-l-4 border-green-500 rounded mb-6">
      <h3 class="text-lg font-semibold">Aluno: <span id="nomeAluno"></span></h3>
      <p class="text-green-800 font-bold">Nível de Aprendizagem: <span id="nivelAprendizagem"></span></p>
    </div>

    <!-- Gráfico -->
    <div class="bg-white p-6 rounded-xl shadow mb-6">
      <canvas id="graficoAluno"></canvas>
    </div>

    <!-- Descrições -->
    <div id="descricoes" class="space-y-4"></div>
  </main>

  <script>
    let dadosPortugues = [], dadosMatematica = [];
    const habilidades = {
      // Português H01–H15
      "H01": "Localizar informações explícitas em textos. Importância: base para a leitura funcional. Prejuízo: compromete a compreensão de enunciados simples.",
      "H02": "Inferir informações implícitas em textos. Importância: desenvolve interpretação crítica. Prejuízo: dificulta entender mensagens não literais.",
      "H03": "Identificar o tema de um texto. Importância: organiza a leitura. Prejuízo: leitura fragmentada, sem compreensão global.",
      "H04": "Distinguir fato de opinião. Importância: promove pensamento crítico. Prejuízo: pode gerar interpretações equivocadas.",
      "H05": "Reconhecer efeitos de sentido do uso de recursos linguísticos. Importância: amplia leitura. Prejuízo: leitura superficial.",
      "H06": "Identificar finalidade de textos. Importância: orienta usos sociais da leitura. Prejuízo: mau uso da informação.",
      "H07": "Estabelecer relações de causa e consequência. Importância: favorece análise lógica. Prejuízo: limita raciocínio dedutivo.",
      "H08": "Identificar elementos coesivos. Importância: garante compreensão textual. Prejuízo: dificuldade em textos longos.",
      "H09": "Interpretar metáforas e figuras de linguagem. Importância: favorece leitura literária. Prejuízo: empobrecimento cultural.",
      "H10": "Reconhecer variedades linguísticas. Importância: respeito à diversidade. Prejuízo: discriminação e incompreensão.",
      "H11": "Analisar argumentos em textos de opinião. Importância: promove cidadania crítica. Prejuízo: fragilidade em debates.",
      "H12": "Reconhecer gêneros textuais. Importância: orienta produção textual. Prejuízo: inadequação comunicativa.",
      "H13": "Identificar recursos de persuasão. Importância: defesa contra manipulação. Prejuízo: maior vulnerabilidade social.",
      "H14": "Avaliar fidedignidade de fontes. Importância: combate fake news. Prejuízo: risco de desinformação.",
      "H15": "Produzir textos coerentes. Importância: comunicação efetiva. Prejuízo: limitação na vida acadêmica e profissional.",

      // Matemática HM01–HM20
      "HM01": "Ler e interpretar gráficos simples. Importância: uso cotidiano. Prejuízo: dificuldade em compreender dados básicos.",
      "HM02": "Resolver operações com números naturais. Importância: base da aritmética. Prejuízo: fragilidade em cálculos simples.",
      "HM03": "Resolver problemas com as quatro operações. Importância: raciocínio lógico. Prejuízo: limitações em situações diárias.",
      "HM04": "Compreender múltiplos e divisores. Importância: fundamenta frações. Prejuízo: compromete estudos posteriores.",
      "HM05": "Utilizar frações em problemas. Importância: proporções. Prejuízo: falhas em medidas e receitas.",
      "HM06": "Relacionar frações, decimais e porcentagens. Importância: vida financeira. Prejuízo: dificuldade em cálculos cotidianos.",
      "HM07": "Resolver problemas de proporcionalidade. Importância: regra de três. Prejuízo: falhas em finanças e medidas.",
      "HM08": "Calcular médias. Importância: análise de dados. Prejuízo: incompreensão estatística.",
      "HM09": "Resolver equações do 1º grau. Importância: base da álgebra. Prejuízo: dificuldade em resolver problemas algébricos.",
      "HM10": "Compreender equações do 2º grau. Importância: funções quadráticas. Prejuízo: impede avanços em matemática.",
      "HM11": "Identificar funções lineares. Importância: modelagem matemática. Prejuízo: falhas em interpretação de gráficos.",
      "HM12": "Trabalhar com sistemas lineares. Importância: múltiplas variáveis. Prejuízo: impede estudos avançados.",
      "HM13": "Calcular área de figuras planas. Importância: vida prática. Prejuízo: erros em construções e projetos.",
      "HM14": "Calcular volume de sólidos. Importância: ciências aplicadas. Prejuízo: dificuldades em engenharia básica.",
      "HM15": "Interpretar escalas. Importância: mapas e plantas. Prejuízo: dificuldade em localização espacial.",
      "HM16": "Resolver problemas com ângulos. Importância: geometria. Prejuízo: falhas em raciocínio espacial.",
      "HM17": "Utilizar teorema de Pitágoras. Importância: cálculo geométrico. Prejuízo: barreiras em trigonometria.",
      "HM18": "Resolver problemas de probabilidade. Importância: análise de risco. Prejuízo: limitações em decisões informadas.",
      "HM19": "Resolver problemas de estatística básica. Importância: compreensão de dados. Prejuízo: vulnerabilidade à manipulação.",
      "HM20": "Interpretar funções exponenciais. Importância: crescimento populacional/financeiro. Prejuízo: incompreensão de fenômenos modernos."
    };

    // Configuração do gráfico
    const ctx = document.getElementById('graficoAluno').getContext('2d');
    let grafico = new Chart(ctx, {
      type: 'bar',
      data: { labels: [], datasets: [] },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' },
          tooltip: {
            callbacks: {
              title: (context) => context[0].label,
              label: (context) => habilidades[context.label] || "Sem descrição disponível"
            }
          }
        },
        scales: { y: { beginAtZero: true, max: 4, ticks: { stepSize: 1 } } }
      }
    });

    // Carregar CSVs
    function carregarCSV(url, destino) {
      Papa.parse(url, {
        download: true,
        header: true,
        delimiter: ";",
        complete: (results) => destino.push(...results.data)
      });
    }
    carregarCSV("port9.csv", dadosPortugues);
    carregarCSV("mat9.csv", dadosMatematica);
    carregarCSV("port3.csv", dadosPortugues);
    carregarCSV("mat3.csv", dadosMatematica);

    // Atualizar lista de alunos
    document.getElementById('turmaSelect').addEventListener('change', (e) => {
      const turma = e.target.value;
      const alunos = (turma === "9ano" ? dadosPortugues : dadosMatematica)
        .map(l => l.Estudante).filter((v, i, a) => a.indexOf(v) === i);
      const sel = document.getElementById('alunoSelect');
      sel.innerHTML = "<option value=''>Selecione o aluno</option>";
      alunos.forEach(a => {
        const opt = document.createElement('option');
        opt.value = a; opt.textContent = a; sel.appendChild(opt);
      });
    });

    // Atualizar gráfico e descrições
    document.getElementById('alunoSelect').addEventListener('change', (e) => {
      const aluno = e.target.value;
      if (!aluno) return;

      const port = dadosPortugues.find(d => d.Estudante === aluno);
      const mat = dadosMatematica.find(d => d.Estudante === aluno);

      document.getElementById("infoAluno").classList.remove("hidden");
      document.getElementById("nomeAluno").textContent = aluno;
      document.getElementById("nivelAprendizagem").textContent = port?.["Níveis de Aprendizagem"] || mat?.["Níveis de Aprendizagem"] || "Não informado";

      const labels = [];
      const dadosP = [], dadosM = [];

      if (port) {
        Object.keys(port).forEach(k => {
          if (k.startsWith("H")) { labels.push(k); dadosP.push(parseInt(port[k]) || 0); dadosM.push(0); }
        });
      }
      if (mat) {
        Object.keys(mat).forEach(k => {
          if (k.startsWith("HM")) { labels.push(k); dadosM.push(parseInt(mat[k]) || 0); dadosP.push(0); }
        });
      }

      grafico.data.labels = labels;
      grafico.data.datasets = [
        { label: "Português", data: dadosP, backgroundColor: "rgba(37, 99, 235, 0.7)" },
        { label: "Matemática", data: dadosM, backgroundColor: "rgba(234, 88, 12, 0.7)" }
      ];
      grafico.update();

      // Listar descrições formais
      const div = document.getElementById("descricoes");
      div.innerHTML = "";
      labels.forEach(h => {
        const p = document.createElement("p");
        p.className = "p-3 border-b";
        p.innerHTML = `<strong>${h}:</strong> ${habilidades[h] || "Sem descrição disponível."}`;
        div.appendChild(p);
      });
    });
  </script>
</body>
</html>
