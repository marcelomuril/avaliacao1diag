<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>CCM SebastiÃ£o ParanÃ¡ - 1Âª AvaliaÃ§Ã£o DiagnÃ³stica 2025</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #grafico-container { height: 400px; }
  </style>
</head>
<body class="bg-gray-100 p-6">
  <header class="text-center mb-6">
    <h1 class="text-3xl font-bold">CCM SebastiÃ£o ParanÃ¡</h1>
    <h2 class="text-xl">1Âª AvaliaÃ§Ã£o DiagnÃ³stica 2025</h2>
  </header>

  <div class="flex flex-col md:flex-row gap-4 mb-6">
    <select id="anoSelect" class="p-2 border rounded w-full md:w-1/2" onchange="carregarAlunos()">
      <option value="">Selecione o ano/sÃ©rie</option>
      <option value="9">9Âº Ano - Fundamental</option>
      <option value="3">3Âª SÃ©rie - Ensino MÃ©dio</option>
    </select>
    <select id="alunoSelect" class="p-2 border rounded w-full md:w-1/2" onchange="carregarGrafico()">
      <option value="">Selecione o aluno</option>
    </select>
  </div>

  <div id="grafico-container">
    <canvas id="grafico"></canvas>
  </div>

  <div id="descritores" class="mt-8 bg-white p-4 rounded shadow"></div>

<script>
const arquivos = {
  "port9": "port9.csv",
  "mat9": "mat9.csv",
  "port3": "port3.csv",
  "mat3": "mat3.csv"
};

const descritoresPort = {
  "P01": "Identificar informaÃ§Ãµes explÃ­citas em textos. AplicaÃ§Ã£o: compreensÃ£o imediata. PrejuÃ­zo: dificuldade em ler avisos simples.",
  "P02": "Inferir informaÃ§Ãµes implÃ­citas em textos. AplicaÃ§Ã£o: interpretaÃ§Ã£o. PrejuÃ­zo: mÃ¡ compreensÃ£o de mensagens.",
  "P03": "Distinguir ideia principal e secundÃ¡ria. AplicaÃ§Ã£o: foco em leituras. PrejuÃ­zo: dispersÃ£o na compreensÃ£o.",
  "P04": "Reconhecer gÃªneros textuais. AplicaÃ§Ã£o: adaptar a linguagem. PrejuÃ­zo: uso inadequado da comunicaÃ§Ã£o.",
  "P05": "Relacionar pronomes e seus referentes. AplicaÃ§Ã£o: coesÃ£o textual. PrejuÃ­zo: dificuldade em entender conexÃµes.",
  "P06": "Identificar efeitos de sentido em palavras. AplicaÃ§Ã£o: enriquecer vocabulÃ¡rio. PrejuÃ­zo: compreensÃ£o limitada.",
  "P07": "Analisar recursos linguÃ­sticos. AplicaÃ§Ã£o: persuasÃ£o e estilo. PrejuÃ­zo: leitura rasa.",
  "P08": "Interpretar grÃ¡ficos e tabelas em textos. AplicaÃ§Ã£o: leitura de dados. PrejuÃ­zo: dificuldade em provas e relatÃ³rios.",
  "P09": "Reconhecer marcas de oralidade em textos escritos. AplicaÃ§Ã£o: distinguir contextos. PrejuÃ­zo: uso inapropriado da linguagem.",
  "P10": "Entender progressÃ£o temÃ¡tica em textos. AplicaÃ§Ã£o: construir textos claros. PrejuÃ­zo: dificuldade em escrever.",
  "P11": "Identificar argumentos em textos. AplicaÃ§Ã£o: debates e defesas. PrejuÃ­zo: aceitaÃ§Ã£o sem questionar.",
  "P12": "Estabelecer relaÃ§Ãµes entre partes do texto. AplicaÃ§Ã£o: lÃ³gica textual. PrejuÃ­zo: leitura fragmentada.",
  "P13": "Reconhecer efeitos de ironia ou humor. AplicaÃ§Ã£o: compreensÃ£o crÃ­tica. PrejuÃ­zo: interpretaÃ§Ãµes erradas.",
  "P14": "Comparar informaÃ§Ãµes em diferentes textos. AplicaÃ§Ã£o: anÃ¡lise crÃ­tica. PrejuÃ­zo: falta de visÃ£o ampla.",
  "P15": "Avaliar a intenÃ§Ã£o comunicativa do autor. AplicaÃ§Ã£o: postura crÃ­tica. PrejuÃ­zo: manipulaÃ§Ã£o por informaÃ§Ãµes."
};

const descritoresMat = {
  "M01": "Resolver adiÃ§Ãµes e subtraÃ§Ãµes. AplicaÃ§Ã£o: compras e troco. PrejuÃ­zo: dependÃªncia da calculadora.",
  "M02": "Resolver multiplicaÃ§Ãµes e divisÃµes. AplicaÃ§Ã£o: cÃ¡lculos do dia a dia. PrejuÃ­zo: lentidÃ£o em tarefas simples.",
  "M03": "Resolver problemas com operaÃ§Ãµes mistas. AplicaÃ§Ã£o: planejamento financeiro. PrejuÃ­zo: erros em contas.",
  "M04": "Entender fraÃ§Ãµes. AplicaÃ§Ã£o: receitas, medidas. PrejuÃ­zo: falha em proporÃ§Ãµes.",
  "M05": "Trabalhar com decimais. AplicaÃ§Ã£o: preÃ§os, descontos. PrejuÃ­zo: erros em cÃ¡lculos.",
  "M06": "Entender porcentagens. AplicaÃ§Ã£o: juros, promoÃ§Ãµes. PrejuÃ­zo: prejuÃ­zos financeiros.",
  "M07": "Resolver expressÃµes numÃ©ricas. AplicaÃ§Ã£o: regras matemÃ¡ticas. PrejuÃ­zo: cÃ¡lculos incorretos.",
  "M08": "Interpretar grÃ¡ficos e tabelas. AplicaÃ§Ã£o: leitura de dados. PrejuÃ­zo: dificuldade em provas.",
  "M09": "Resolver equaÃ§Ãµes simples. AplicaÃ§Ã£o: Ã¡lgebra bÃ¡sica. PrejuÃ­zo: dificuldade em conteÃºdos futuros.",
  "M10": "Resolver problemas com equaÃ§Ãµes. AplicaÃ§Ã£o: modelagem matemÃ¡tica. PrejuÃ­zo: nÃ£o compreender lÃ³gica.",
  "M11": "Compreender proporcionalidade. AplicaÃ§Ã£o: mapas, escalas. PrejuÃ­zo: erros em medidas.",
  "M12": "Resolver regra de trÃªs. AplicaÃ§Ã£o: cÃ¡lculos prÃ¡ticos. PrejuÃ­zo: limitaÃ§Ãµes em problemas diÃ¡rios.",
  "M13": "Entender mÃ©dias. AplicaÃ§Ã£o: estatÃ­sticas escolares. PrejuÃ­zo: interpretaÃ§Ã£o errada de resultados.",
  "M14": "Compreender geometria plana. AplicaÃ§Ã£o: construÃ§Ãµes, artes. PrejuÃ­zo: falhas em desenho tÃ©cnico.",
  "M15": "Compreender geometria espacial. AplicaÃ§Ã£o: embalagens, arquitetura. PrejuÃ­zo: dificuldade em visualizar objetos.",
  "M16": "Entender medidas de tempo e massa. AplicaÃ§Ã£o: cotidiano. PrejuÃ­zo: erros em planejamento.",
  "M17": "Resolver problemas com Ã¡reas. AplicaÃ§Ã£o: construÃ§Ã£o civil. PrejuÃ­zo: cÃ¡lculo errado de materiais.",
  "M18": "Resolver problemas com volume. AplicaÃ§Ã£o: recipientes, lÃ­quidos. PrejuÃ­zo: uso incorreto de recursos."
};

let dadosCSV = {};
let chart;

function carregarCSVs() {
  Object.entries(arquivos).forEach(([key, file]) => {
    Papa.parse(file, {
      download: true,
      header: true,
      complete: results => { dadosCSV[key] = results.data; }
    });
  });
}

function carregarAlunos() {
  const ano = document.getElementById("anoSelect").value;
  const alunoSelect = document.getElementById("alunoSelect");
  alunoSelect.innerHTML = '<option value="">Selecione o aluno</option>';
  if (!ano) return;

  const lista = [...new Set(dadosCSV["port"+ano].map(l => l.Estudante))];
  lista.forEach(aluno => {
    if (aluno) {
      const opt = document.createElement("option");
      opt.value = aluno; opt.textContent = aluno;
      alunoSelect.appendChild(opt);
    }
  });
}

function carregarGrafico() {
  const ano = document.getElementById("anoSelect").value;
  const aluno = document.getElementById("alunoSelect").value;
  if (!ano || !aluno) return;

  const port = dadosCSV["port"+ano].find(l => l.Estudante === aluno);
  const mat = dadosCSV["mat"+ano].find(l => l.Estudante === aluno);

  const portData = Object.keys(descritoresPort).map((h, i) => {
    const col = `H ${String(i+1).padStart(2,"0")}`;
    return parseInt(port?.[col] || 0);
  });

  const matData = Object.keys(descritoresMat).map((h, i) => {
    const col = `H ${String(i+1).padStart(2,"0")}`;
    return parseInt(mat?.[col] || 0);
  });

  const labels = [...Object.keys(descritoresPort), ...Object.keys(descritoresMat)];

  const ctx = document.getElementById("grafico").getContext("2d");
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        { label: "PortuguÃªs", data: [...portData, ...Array(18).fill(null)], backgroundColor: "rgba(54,162,235,0.7)" },
        { label: "MatemÃ¡tica", data: [...Array(15).fill(null), ...matData], backgroundColor: "rgba(255,99,132,0.7)" }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => {
              const key = ctx.label;
              return (descritoresPort[key] || descritoresMat[key]) + " â†’ Acertos: " + ctx.formattedValue;
            }
          }
        }
      },
      scales: { y: { beginAtZero: true } }
    }
  });

  let html = `<h3 class="text-xl font-bold mb-3">ðŸ“˜ PortuguÃªs</h3><ul class="list-disc pl-5 mb-6">`;
  for (let [k,v] of Object.entries(descritoresPort)) html += `<li><b>${k}</b> â€“ ${v}</li>`;
  html += `</ul><h3 class="text-xl font-bold mb-3">ðŸ”¢ MatemÃ¡tica</h3><ul class="list-disc pl-5">`;
  for (let [k,v] of Object.entries(descritoresMat)) html += `<li><b>${k}</b> â€“ ${v}</li>`;
  html += `</ul>`;
  document.getElementById("descritores").innerHTML = html;
}

carregarCSVs();
</script>
</body>
</html>
