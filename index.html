<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>1ª Avaliação Diagnóstica 2025</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    header { text-align: center; margin-bottom: 20px; }
    #grafico { max-width: 100%; height: 400px; }
  </style>
</head>
<body>
  <header>
    <h1>CCM SEBASTIÃO PARANÁ</h1>
    <h2>1ª Avaliação Diagnóstica 2025</h2>
  </header>

  <label for="anoSelect">Selecione o ano:</label>
  <select id="anoSelect">
    <option value="">-- Escolha --</option>
    <option value="9">9º Ano</option>
    <option value="3">3ª Série</option>
  </select>

  <label for="alunoSelect">Selecione o aluno:</label>
  <select id="alunoSelect"></select>

  <div style="width:100%; height:400px;">
    <canvas id="grafico"></canvas>
  </div>

  <div id="descritores"></div>

<script>
const descritoresPort = {
  "P01": "Identificar informações diretas em textos.",
  "P02": "Reconhecer tema principal de um texto.",
  "P03": "Inferir informações implícitas.",
  "P04": "Interpretar metáforas ou sentidos figurados.",
  "P05": "Reconhecer propósito de um texto.",
  "P06": "Identificar gênero textual.",
  "P07": "Distinguir fato de opinião.",
  "P08": "Relacionar informações entre textos.",
  "P09": "Analisar argumentos apresentados.",
  "P10": "Identificar a ideia central de parágrafos.",
  "P11": "Inferir sentimentos e intenções do autor.",
  "P12": "Relacionar imagens e legendas.",
  "P13": "Compreender vocabulário no contexto.",
  "P14": "Reconhecer relações de causa e consequência.",
  "P15": "Sintetizar informações de diferentes partes."
};

const descritoresMat = {
  "M01": "Efetuar cálculos básicos de adição e subtração.",
  "M02": "Resolver multiplicações e divisões simples.",
  "M03": "Compreender o sistema de numeração decimal.",
  "M04": "Resolver problemas com números inteiros.",
  "M05": "Trabalhar com frações e decimais.",
  "M06": "Calcular porcentagens em situações práticas.",
  "M07": "Interpretar gráficos e tabelas.",
  "M08": "Resolver problemas com grandezas proporcionais.",
  "M09": "Aplicar medidas de tempo, massa e comprimento.",
  "M10": "Reconhecer figuras geométricas planas.",
  "M11": "Calcular perímetro e área de figuras.",
  "M12": "Identificar sólidos geométricos.",
  "M13": "Aplicar simetria e transformações geométricas.",
  "M14": "Resolver equações do 1º grau.",
  "M15": "Resolver sistemas de equações.",
  "M16": "Interpretar funções e gráficos.",
  "M17": "Aplicar probabilidade em situações práticas.",
  "M18": "Resolver problemas com estatística básica."
};

let dadosCSV = {};
let chart = null;

function carregarCSV() {
  const arquivos = {
    "port9": "port9.csv",
    "mat9": "mat9.csv",
    "port3": "port3.csv",
    "mat3": "mat3.csv"
  };
  for (let key in arquivos) {
    Papa.parse(arquivos[key], {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: results => {
        // normaliza os nomes das colunas
        results.meta.fields = results.meta.fields.map(h => h.trim());
        results.data = results.data.map(row => {
          const novo = {};
          for (let k in row) {
            if (row.hasOwnProperty(k)) novo[k.trim()] = row[k];
          }
          return novo;
        });
        dadosCSV[key] = results.data;
      }
    });
  }
}

function atualizarAlunos() {
  const ano = document.getElementById("anoSelect").value;
  const selAluno = document.getElementById("alunoSelect");
  selAluno.innerHTML = "";
  if (!ano) return;
  const alunos = [...new Set(dadosCSV["port"+ano].map(l => l.Estudante))];
  alunos.forEach(a => {
    const opt = document.createElement("option");
    opt.value = a;
    opt.textContent = a;
    selAluno.appendChild(opt);
  });
}

function carregarGrafico() {
  const ano = document.getElementById("anoSelect").value;
  const aluno = document.getElementById("alunoSelect").value;
  if (!ano || !aluno) return;

  const port = dadosCSV["port"+ano].find(l => l.Estudante === aluno);
  const mat = dadosCSV["mat"+ano].find(l => l.Estudante === aluno);

  const portData = Object.keys(descritoresPort).map((h,i)=>{
    const col = `H ${String(i+1).padStart(2,"0")}`;
    return parseInt(port?.[col] || 0);
  });
  const matData = Object.keys(descritoresMat).map((h,i)=>{
    const col = `H ${String(i+1).padStart(2,"0")}`;
    return parseInt(mat?.[col] || 0);
  });

  const labels = [...Object.keys(descritoresPort), ...Object.keys(descritoresMat)];

  const ctx = document.getElementById("grafico").getContext("2d");
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        { label:"Português", data:[...portData, ...Array(18).fill(null)], backgroundColor:"rgba(54,162,235,0.7)" },
        { label:
