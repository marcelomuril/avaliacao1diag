<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Avalia√ß√£o Diagn√≥stica 2025</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f8f9fa;
      color: #333;
    }
    header {
      background: #2f4050;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .container {
      padding: 20px;
      max-width: 1100px;
      margin: auto;
    }
    select {
      padding: 8px;
      margin: 10px 5px;
      font-size: 16px;
    }
    #grafico {
      background: white;
      padding: 20px;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      height: 450px !important;
    }
    h3 {
      margin-top: 40px;
      color: #2f4050;
      border-left: 6px solid #2f4050;
      padding-left: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table tr:nth-child(even) { background: #f1f1f1; }
    table tr:nth-child(odd) { background: #ffffff; }
    table td {
      padding: 10px;
      vertical-align: top;
    }
    table td:first-child {
      font-weight: bold;
      width: 80px;
      color: #2f4050;
    }
  </style>
</head>
<body>
  <header>
    CCM SEBASTI√ÉO PARAN√Å ‚Äì 1¬™ AVALIA√á√ÉO DIAGN√ìSTICA 2025
  </header>

  <div class="container">
    <label for="anoSelect">Selecione o ano:</label>
    <select id="anoSelect" onchange="carregarAlunos()">
      <option value="">-- Selecione --</option>
      <option value="9">9¬∫ Ano</option>
      <option value="3">3¬™ S√©rie EM</option>
    </select>

    <label for="alunoSelect">Selecione o aluno:</label>
    <select id="alunoSelect" onchange="carregarGrafico()">
      <option value="">-- Selecione --</option>
    </select>

    <canvas id="grafico"></canvas>
    <div id="descritores"></div>
  </div>

  <script>
    let dadosCSV = {};
    let chart;

    const descritoresPort = {
      "H01": "Identificar informa√ß√µes diretas em um texto. Preju√≠zo: dificuldade em compreender instru√ß√µes simples.",
      "H02": "Inferir informa√ß√µes impl√≠citas. Preju√≠zo: limita a interpreta√ß√£o de textos.",
      "H03": "Reconhecer tema ou ideia central. Preju√≠zo: compreens√£o global deficiente.",
      "H04": "Relacionar partes do texto. Preju√≠zo: dificuldade em seguir narrativas longas.",
      "H05": "Identificar finalidade de textos. Preju√≠zo: confus√£o ao lidar com documentos do dia a dia.",
      "H06": "Diferenciar fatos de opini√µes. Preju√≠zo: maior suscetibilidade a fake news.",
      "H07": "Interpretar recursos lingu√≠sticos. Preju√≠zo: dificuldade em perceber ironia ou humor.",
      "H08": "Analisar efeitos de sentido. Preju√≠zo: compreens√£o superficial do texto.",
      "H09": "Reconhecer g√™neros textuais. Preju√≠zo: n√£o distinguir carta, not√≠cia, artigo.",
      "H10": "Usar elementos de coes√£o. Preju√≠zo: dificuldade em produzir textos claros.",
      "H11": "Analisar argumenta√ß√£o. Preju√≠zo: pouca criticidade em debates.",
      "H12": "Reconhecer varia√ß√µes lingu√≠sticas. Preju√≠zo: preconceitos lingu√≠sticos.",
      "H13": "Interpretar met√°foras. Preju√≠zo: leitura literal demais.",
      "H14": "Avaliar diferentes pontos de vista. Preju√≠zo: menor empatia e di√°logo.",
      "H15": "Produzir textos com clareza. Preju√≠zo: problemas em provas e vida profissional."
    };

    const descritoresMat = {
      "HM01": "Resolver opera√ß√µes b√°sicas. Preju√≠zo: dificuldade em situa√ß√µes cotidianas.",
      "HM02": "Compreender o sistema de numera√ß√£o. Preju√≠zo: erros frequentes em c√°lculos.",
      "HM03": "Opera√ß√µes com n√∫meros inteiros. Preju√≠zo: dificuldade em problemas pr√°ticos.",
      "HM04": "Opera√ß√µes com fra√ß√µes. Preju√≠zo: problemas em receitas e medi√ß√µes.",
      "HM05": "Resolver problemas com decimais. Preju√≠zo: dificuldade em dinheiro e medidas.",
      "HM06": "Opera√ß√µes com porcentagem. Preju√≠zo: problemas em descontos e juros.",
      "HM07": "Resolver equa√ß√µes simples. Preju√≠zo: dificuldade em √°lgebra.",
      "HM08": "Compreender express√µes alg√©bricas. Preju√≠zo: travas no racioc√≠nio matem√°tico.",
      "HM09": "Resolver sistemas lineares. Preju√≠zo: dificuldade em planejamentos.",
      "HM10": "Identificar grandezas proporcionais. Preju√≠zo: erros em escalas e mapas.",
      "HM11": "Resolver problemas de regra de tr√™s. Preju√≠zo: dificuldade em convers√µes pr√°ticas.",
      "HM12": "Identificar figuras geom√©tricas. Preju√≠zo: dificuldade em visualiza√ß√£o espacial.",
      "HM13": "Calcular per√≠metro e √°rea. Preju√≠zo: problemas em constru√ß√µes e cotidiano.",
      "HM14": "Resolver problemas de volume. Preju√≠zo: erros em recipientes e medidas.",
      "HM15": "Interpretar gr√°ficos e tabelas. Preju√≠zo: dificuldade em relat√≥rios e estat√≠sticas.",
      "HM16": "Calcular m√©dias. Preju√≠zo: problemas em avalia√ß√µes e dados.",
      "HM17": "Analisar probabilidade. Preju√≠zo: dificuldade em jogos e previs√µes.",
      "HM18": "Resolver problemas de estat√≠stica. Preju√≠zo: limita√ß√µes em tomada de decis√£o.",
      "HM19": "Aplicar teorema de Pit√°goras. Preju√≠zo: dificuldade em c√°lculos de espa√ßo.",
      "HM20": "Interpretar fun√ß√µes. Preju√≠zo: dificuldade em modelar situa√ß√µes reais."
    };

    function carregarCSVs() {
      const arquivos = {
        "port9": "port9.csv",
        "mat9": "mat9.csv",
        "port3": "port3.csv",
        "mat3": "mat3.csv"
      };

      for (let key in arquivos) {
        Papa.parse(arquivos[key], {
          download: true,
          header: true,
          skipEmptyLines: true,
          complete: results => {
            // limpa cabe√ßalhos
            results.meta.fields = results.meta.fields.map(h => h.trim());
            results.data = results.data.map(row => {
              const novo = {};
              for (let k in row) novo[k.trim()] = row[k];
              return novo;
            });
            dadosCSV[key] = results.data;
          }
        });
      }
    }

    function carregarAlunos() {
      const ano = document.getElementById("anoSelect").value;
      const sel = document.getElementById("alunoSelect");
      sel.innerHTML = "<option value=''>-- Selecione --</option>";
      if (!ano) return;
      const alunos = dadosCSV["port" + ano].map(l => l.Estudante);
      alunos.forEach(a => sel.innerHTML += `<option value="${a}">${a}</option>`);
    }

    function carregarGrafico() {
      const ano = document.getElementById("anoSelect").value;
      const aluno = document.getElementById("alunoSelect").value;
      if (!ano || !aluno) return;

      const port = dadosCSV["port" + ano].find(l => l.Estudante === aluno);
      const mat = dadosCSV["mat" + ano].find(l => l.Estudante === aluno);

      // portugu√™s
      const portData = Object.keys(descritoresPort).map((h, i) => {
        const col = `H ${String(i+1).padStart(2,"0")}`;
        return parseInt(port?.[col] || 0);
      });

      // matem√°tica
      const matData = Object.keys(descritoresMat).map((h, i) => {
        const col = `HM ${String(i+1).padStart(2,"0")}`;
        return parseInt(mat?.[col] || 0);
      });

      const labels = [...Object.keys(descritoresPort), ...Object.keys(descritoresMat)];

      const ctx = document.getElementById("grafico").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [
            { label: "Portugu√™s", data: [...portData, ...Array(matData.length).fill(null)], backgroundColor: "rgba(54,162,235,0.85)", barThickness: 28 },
            { label: "Matem√°tica", data: [...Array(portData.length).fill(null), ...matData], backgroundColor: "rgba(255,99,132,0.85)", barThickness: 28 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            tooltip: {
              callbacks: {
                label: ctx => {
                  const key = ctx.label;
                  return (descritoresPort[key] || descritoresMat[key]) + " ‚Üí Acertos: " + ctx.formattedValue;
                }
              }
            }
          },
          scales: {
            y: { beginAtZero: true, ticks: { stepSize: 1, color: "#333", font: { size: 14 } } },
            x: { ticks: { color: "#333", font: { size: 12 } } }
          }
        }
      });

      // s√≥ habilidades abaixo de 50%
      let html = "";
      const deficitsPort = Object.keys(descritoresPort).filter((h,i)=> portData[i] < 50);
      const deficitsMat = Object.keys(descritoresMat).filter((h,i)=> matData[i] < 50);

      if (deficitsPort.length > 0) {
        html += `<h3>üìò Portugu√™s ‚Äì Habilidades com d√©ficit</h3><table>`;
        deficitsPort.forEach(h=> html += `<tr><td>${h}</td><td>${descritoresPort[h]}</td></tr>`);
        html += `</table>`;
      }
      if (deficitsMat.length > 0) {
        html += `<h3>üî¢ Matem√°tica ‚Äì Habilidades com d√©ficit</h3><table>`;
        deficitsMat.forEach(h=> html += `<tr><td>${h}</td><td>${descritoresMat[h]}</td></tr>`);
        html += `</table>`;
      }

      document.getElementById("descritores").innerHTML = html;
    }

    carregarCSVs();
  </script>
</body>
</html>
