<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1¬™ Avalia√ß√£o Diagn√≥stica 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-blue-800 text-white p-6 text-center shadow-md">
    <h1 class="text-2xl font-bold">CCM SEBASTI√ÉO PARAN√Å</h1>
    <h2 class="text-lg">1¬™ AVALIA√á√ÉO DIAGN√ìSTICA 2025</h2>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <div class="mb-4">
      <label class="block mb-2 font-semibold">Selecione o Ano Escolar:</label>
      <select id="anoSelect" class="p-2 border rounded w-full">
        <option value="">-- Escolha --</option>
        <option value="9">9¬∫ Ano Fundamental</option>
        <option value="3">3¬™ S√©rie Ensino M√©dio</option>
      </select>
    </div>

    <div class="mb-4">
      <label class="block mb-2 font-semibold">Selecione o Aluno:</label>
      <select id="alunoSelect" class="p-2 border rounded w-full">
        <option value="">-- Escolha --</option>
      </select>
    </div>

    <div class="bg-white shadow-lg rounded-lg p-4 mb-6">
      <canvas id="grafico" class="w-full h-[400px]"></canvas>
    </div>

    <section id="descritoresBox" class="space-y-6"></section>
  </main>

  <script>
    // Arquivos CSV por ano
    const arquivos = {
      9: { port: "port9.csv", mat: "mat9.csv" },
      3: { port: "port3.csv", mat: "mat3.csv" }
    };

    // Descritores gen√©ricos Portugu√™s
    const descritoresPort = {
      H01: { texto: "Localizar informa√ß√µes expl√≠citas em textos.", aplic: "Apoia leitura literal e compreens√£o inicial.", prej: "Sem isso, o aluno n√£o entende enunciados simples." },
      H02: { texto: "Inferir informa√ß√µes impl√≠citas.", aplic: "Exercita leitura cr√≠tica.", prej: "Dificuldade em compreender mensagens ocultas." },
      H03: { texto: "Identificar a ideia principal.", aplic: "Ajuda a resumir textos.", prej: "Pode se perder em informa√ß√µes secund√°rias." },
      H04: { texto: "Relacionar informa√ß√µes em textos.", aplic: "Permite conectar ideias.", prej: "Compromete a coes√£o e interpreta√ß√£o." },
      H05: { texto: "Interpretar gr√°ficos, tabelas e imagens.", aplic: "Desenvolve leitura multimodal.", prej: "Dificuldade em provas e situa√ß√µes pr√°ticas." },
      H06: { texto: "Aplicar regras ortogr√°ficas.", aplic: "Garante escrita correta.", prej: "Erros frequentes comprometem clareza." },
      H07: { texto: "Usar gram√°tica e pontua√ß√£o.", aplic: "Facilita express√£o clara.", prej: "Compromete compreens√£o dos textos." },
      H08: { texto: "Reconhecer g√™neros textuais.", aplic: "Favorece adequa√ß√£o de linguagem.", prej: "Prejudica interpreta√ß√£o de textos diversos." }
    };

    // Descritores gen√©ricos Matem√°tica
    const descritoresMat = {
      H09: { texto: "Efetuar c√°lculos b√°sicos.", aplic: "Base para opera√ß√µes di√°rias.", prej: "Dificuldade em problemas simples." },
      H10: { texto: "Resolver problemas com m√∫ltiplas opera√ß√µes.", aplic: "Exercita racioc√≠nio l√≥gico.", prej: "Erros em quest√µes de contexto real." },
      H11: { texto: "Manipular express√µes alg√©bricas.", aplic: "Base para √°lgebra avan√ßada.", prej: "Dificulta progress√£o nos estudos." },
      H12: { texto: "Resolver equa√ß√µes e inequa√ß√µes.", aplic: "Essencial em situa√ß√µes pr√°ticas.", prej: "Compromete avan√ßo em matem√°tica." },
      H13: { texto: "Reconhecer e aplicar geometria.", aplic: "Importante em espa√ßo e forma.", prej: "Dificuldade em leitura de mapas e figuras." },
      H14: { texto: "Interpretar dados estat√≠sticos.", aplic: "Base para tomada de decis√£o.", prej: "Compromete leitura cr√≠tica de informa√ß√µes." },
      H15: { texto: "Resolver problemas de probabilidade.", aplic: "Importante em estat√≠stica.", prej: "N√£o entende previs√µes ou estimativas." }
    };

    let dadosPort = [], dadosMat = [];
    let grafico = null;

    const anoSelect = document.getElementById("anoSelect");
    const alunoSelect = document.getElementById("alunoSelect");
    const ctx = document.getElementById("grafico").getContext("2d");
    const descritoresBox = document.getElementById("descritoresBox");

    // Carrega CSVs
    function carregarCSVs(ano) {
      return new Promise(resolve => {
        let { port, mat } = arquivos[ano];
        Papa.parse(port, {
          download: true,
          header: true,
          complete: results => {
            dadosPort = results.data;
            Papa.parse(mat, {
              download: true,
              header: true,
              complete: results2 => {
                dadosMat = results2.data;
                resolve();
              }
            });
          }
        });
      });
    }

    // Preenche lista alunos
    function preencherAlunos() {
      alunoSelect.innerHTML = '<option value="">-- Escolha --</option>';
      dadosPort.forEach(linha => {
        if (linha["Estudante"]) {
          let opt = document.createElement("option");
          opt.value = linha["Estudante"];
          opt.textContent = linha["Estudante"];
          alunoSelect.appendChild(opt);
        }
      });
    }

    // Gera gr√°fico
    function gerarGrafico(aluno) {
      let linhaPort = dadosPort.find(l => l["Estudante"] === aluno);
      let linhaMat = dadosMat.find(l => l["Estudante"] === aluno);
      if (!linhaPort || !linhaMat) return;

      let labels = [];
      let valoresPort = [], valoresMat = [];

      for (let i = 1; i <= 15; i++) {
        let col = "H " + String(i).padStart(2, "0");
        labels.push("H" + String(i).padStart(2, "0"));
        valoresPort.push(parseInt(linhaPort[col] || 0));
        valoresMat.push(parseInt(linhaMat[col] || 0));
      }

      if (grafico) grafico.destroy();

      grafico = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [
            { label: "Portugu√™s", data: valoresPort, backgroundColor: "rgba(37, 99, 235, 0.7)" },
            { label: "Matem√°tica", data: valoresMat, backgroundColor: "rgba(234, 88, 12, 0.7)" }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  let habilidade = context.label;
                  let desc = context.dataset.label === "Portugu√™s"
                    ? descritoresPort[habilidade]?.texto
                    : descritoresMat[habilidade]?.texto;
                  return `${context.dataset.label}: ${context.raw} ‚Üí ${desc || ""}`;
                }
              }
            }
          },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: "Acertos" } }
          }
        }
      });

      // Atualiza descri√ß√µes abaixo do gr√°fico
      descritoresBox.innerHTML = `
        <div>
          <h3 class="text-xl font-bold text-blue-700 mb-2">üìò Portugu√™s</h3>
          <ul class="space-y-2">
            ${Object.entries(descritoresPort).map(([h, d]) =>
              `<li><strong>${h}</strong> ‚Äì ${d.texto}<br>
                <em>Aplica√ß√£o:</em> ${d.aplic}<br>
                <em>Preju√≠zo:</em> ${d.prej}</li>`).join("")}
          </ul>
        </div>
        <div>
          <h3 class="text-xl font-bold text-orange-700 mb-2">üî¢ Matem√°tica</h3>
          <ul class="space-y-2">
            ${Object.entries(descritoresMat).map(([h, d]) =>
              `<li><strong>${h}</strong> ‚Äì ${d.texto}<br>
                <em>Aplica√ß√£o:</em> ${d.aplic}<br>
                <em>Preju√≠zo:</em> ${d.prej}</li>`).join("")}
          </ul>
        </div>
      `;
    }

    // Eventos
    anoSelect.addEventListener("change", async () => {
      if (anoSelect.value) {
        await carregarCSVs(anoSelect.value);
        preencherAlunos();
      }
    });
    alunoSelect.addEventListener("change", () => {
      if (alunoSelect.value) gerarGrafico(alunoSelect.value);
    });
  </script>
</body>
</html>
